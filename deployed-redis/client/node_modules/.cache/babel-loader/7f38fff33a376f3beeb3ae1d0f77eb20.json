{"ast":null,"code":"import _slicedToArray from\"C:/Users/Ahmed Saad/Desktop/Distributed-Text-Editor-main/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from'react';import{useCallback,useEffect,useState}from'react';import{useParams}from'react-router-dom';// route to different routes \nimport Quill from\"quill\";import\"quill/dist/quill.snow.css\";import{io}from'socket.io-client';import{Offline,Online}from\"react-detect-offline\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ENDPOINT='https://new-server-proj.herokuapp.com/';var q;var editor2=document.createElement(\"div\");var INTERVAL_MS=2000;export default function TextEdtior(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),socket=_useState2[0],setSocket=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),quill=_useState4[0],setQuill=_useState4[1];var _useParams=useParams(),documentId=_useParams.id;var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),user=_useState6[0],setUser=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),change=_useState8[0],setchange=_useState8[1];//-------------------handling connection-----------------------\nuseEffect(function(){var s=io(ENDPOINT,{transports:['websocket']});// url of server // this function returns a socket(state)\nsetSocket(s);return function(){s.disconnect();//cleaning up \n};},[]);// useEffect? you tell React that your component needs to do something after render(aka display)\n//-------------------loading document----------------------\nuseEffect(function(){if(socket==null||quill==null)return;// we have to make sure they are defined because this func depends on them\n// once automatically cleans up the event after \nsocket.once(\"load-document\",function(document){quill.setContents(document.data);quill.enable();//we enable only if we get document \neditor2.innerHTML=\"Number of Current Users \"+document.user;});socket.emit(\"get-document\",documentId);// send to server document ID\n},[socket,quill,documentId]);useEffect(function(){if(socket==null||quill==null)return;var handler=function handler(delta,oldDelta,source){// we do this because we are only interested in the changes the user makes we do not want\n// any changes done in the library (not by the user to be sent to the clients)\nif(source!=='user')return;socket.emit(\"send-delta\",delta);// is just what changed in the document -- we send this to the server using socket.emit\nsetchange(1);};quill.on('text-change',handler);// text-change quill API, handler is called whenever text-change is on\nreturn function(){quill.off('text-change',handler);// upon cleaning up \n};},[socket,quill,change]);// this func depends on socket,quill\nuseEffect(function(){if(socket==null||quill==null)return;var interval=setInterval(function(){if(change==1){setchange(0);socket.emit(\"save-document\",quill.getContents());}},INTERVAL_MS);return function(){clearInterval(interval);};},[socket,quill,change]);//-------------------updating our document---------------------\nuseEffect(function(){if(socket==null||quill==null)return;var handler=function handler(delta){quill.updateContents(delta);};socket.on('get-delta',handler);return function(){socket.off('get-delta',handler);};},[socket,quill]);//--------------------update number of users-----------------\nuseEffect(function(){if(socket==null)return;socket.on('users',function(user){setUser(user);editor2.innerHTML=\"Number of Current Users \"+user;});},[socket,user]);var wrapperRef=useCallback(function(wrapper){var toolbarOptions=[['bold','italic','underline','strike'],// toggled buttons\n['blockquote','code-block'],[{'list':'ordered'},{'list':'bullet'}],[{'script':'sub'},{'script':'super'}],// superscript/subscript\n[{'indent':'-1'},{'indent':'+1'}],// outdent/indent\n[{'direction':'rtl'}],// text direction\n[{'size':['small',false,'large','huge']}],// custom dropdown\n[{'header':[1,2,3,4,5,6,false]}],[{'color':[]},{'background':[]}],// dropdown with defaults from theme\n[{'font':[]}],[{'align':[]}],['clean']// remove formatting button\n];var editor=document.createElement(\"div\");//create an object editor\nwrapper.append(editor2);// put editor into wrapper \nwrapper.append(editor);// put editor into wrapper \neditor2.innerHTML=\"Number of Current Users \";var el=document.getElementById(\"status\");setInterval(function(){if(el.textContent===\"You are Offline, Please Check your Connection and Try Again!\"){q.disable();}else{q.enable();}},1000);q=new Quill(editor,{theme:\"snow\",modules:{toolbar:toolbarOptions}});q.disable();// if no document then disbale \nq.setText('Loading...');// if disabled display Loading...\nsetQuill(q);},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){var str=window.location.href;var loc=str.substring(str.indexOf('documents')+10);navigator.clipboard.writeText(loc);},children:\"Copy to Clipboard\"})}),/*#__PURE__*/_jsx(\"div\",{id:\"status\",children:/*#__PURE__*/_jsx(Offline,{id:\"offline\",children:\"You are Offline, Please Check your Connection and Try Again!\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"text container\",ref:wrapperRef})]});}","map":{"version":3,"names":["React","useCallback","useEffect","useState","useParams","Quill","io","Offline","Online","ENDPOINT","q","editor2","document","createElement","INTERVAL_MS","TextEdtior","socket","setSocket","quill","setQuill","documentId","id","user","setUser","change","setchange","s","transports","disconnect","once","setContents","data","enable","innerHTML","emit","handler","delta","oldDelta","source","on","off","interval","setInterval","getContents","clearInterval","updateContents","wrapperRef","wrapper","toolbarOptions","editor","append","el","getElementById","textContent","disable","theme","modules","toolbar","setText","str","window","location","href","loc","substring","indexOf","navigator","clipboard","writeText"],"sources":["C:/Users/Ahmed Saad/Desktop/Distributed-Text-Editor-main/client/src/TextEdtior.js"],"sourcesContent":["import React from 'react'\nimport { useCallback, useEffect,useState } from 'react'\nimport {useParams} from 'react-router-dom'  // route to different routes \nimport Quill from \"quill\"\nimport \"quill/dist/quill.snow.css\"\nimport {io} from 'socket.io-client'\nimport { Offline, Online } from \"react-detect-offline\";\nconst ENDPOINT = 'https://new-server-proj.herokuapp.com/';\n\nvar q;\nconst editor2=document.createElement(\"div\") \n\nconst INTERVAL_MS = 2000\n\nexport default function TextEdtior() {\n\nconst [socket,setSocket]=useState()\nconst [quill,setQuill]=useState()\nconst {id: documentId}=useParams()\nconst [user,setUser]=useState(1)\nconst [change,setchange]=useState()\n\n\n//-------------------handling connection-----------------------\n\nuseEffect(() => {\n  const s= io(ENDPOINT, {transports:['websocket']});  // url of server // this function returns a socket(state)\n  setSocket(s)\n   return () => {\n    s.disconnect()  //cleaning up \n   }\n},[])\n\n\n     // useEffect? you tell React that your component needs to do something after render(aka display)\n//-------------------loading document----------------------\nuseEffect (()=>{\n    if(socket== null || quill==null) return // we have to make sure they are defined because this func depends on them\n// once automatically cleans up the event after \n    socket.once (\"load-document\",document =>{\n        quill.setContents (document.data)\n        quill.enable() //we enable only if we get document \n        editor2.innerHTML=\"Number of Current Users \"+document.user\n\n    })\n  socket.emit (\"get-document\",documentId) // send to server document ID\n  },[socket,quill,documentId])\n\n     useEffect(()=> {\n        if(socket== null || quill==null) return\n\n        const handler = (delta,oldDelta,source)=>{\n// we do this because we are only interested in the changes the user makes we do not want\n// any changes done in the library (not by the user to be sent to the clients)\n            if (source!== 'user') return\n            socket.emit(\"send-delta\",delta) // is just what changed in the document -- we send this to the server using socket.emit\n            setchange(1)\n        }\n        quill.on('text-change',handler)  // text-change quill API, handler is called whenever text-change is on\n\n        return () => {\n            quill.off('text-change',handler)  // upon cleaning up \n        }\n    },[socket,quill,change])// this func depends on socket,quill\n    \n        useEffect(() => {\n        if (socket == null || quill == null) return\n    \n        const interval = setInterval(() => {\n            if(change ==1){\n                setchange(0)\n              socket.emit(\"save-document\", quill.getContents())\n              }        \n            }, INTERVAL_MS)\n        return () => {\n          clearInterval(interval)\n        }\n        }, [socket, quill,change])\n        //-------------------updating our document---------------------\n        useEffect(()=> {\n            if(socket== null || quill==null) return\n    \n            const handler = (delta)=>{\n              \n                quill.updateContents(delta)\n            }\n            socket.on('get-delta',handler)\n    \n            return () => {\n                socket.off('get-delta',handler)\n            }\n        },[socket,quill])\n        \n    \n        //--------------------update number of users-----------------\n        useEffect(()=> {\n            if(socket== null) return\n              socket.on('users',user => {\n              setUser(user)\n              editor2.innerHTML=\"Number of Current Users \"+user\n            })\n        },[socket,user])\n    \n    \n    const wrapperRef= useCallback((wrapper) => {\n\n        var toolbarOptions = [\n            ['bold', 'italic', 'underline', 'strike'],        // toggled buttons\n            ['blockquote', 'code-block'],\n          \n            [{ 'list': 'ordered'}, { 'list': 'bullet' }],\n            [{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript\n            [{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent\n            [{ 'direction': 'rtl' }],                         // text direction\n          \n            [{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown\n            [{ 'header': [1, 2, 3, 4, 5, 6, false] }],\n          \n            [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme\n            [{ 'font': [] }],\n            [{ 'align': [] }],\n          \n            ['clean']                                         // remove formatting button\n          ];\n          \n       const editor=document.createElement(\"div\") //create an object editor\n\n       wrapper.append(editor2) // put editor into wrapper \n\n       wrapper.append(editor) // put editor into wrapper \n\n       editor2.innerHTML=\"Number of Current Users \"\n    \n       const el = document.getElementById(\"status\")\n        setInterval(() => {\n          if(el.textContent === \"You are Offline, Please Check your Connection and Try Again!\"){\n            q.disable()\n          }\n          else{\n            q.enable()\n          }\n        }, 1000);\n          \n      q=  new Quill(editor,{theme: \"snow\",\n        modules: {\n            toolbar: toolbarOptions\n            }\n        })\n        q.disable()  // if no document then disbale \n        q.setText('Loading...') // if disabled display Loading...\n        setQuill(q)\n    } ,[])\n\n    return (\n        <>\n  <div>\n    <button onClick={()=>{\n        var str = window.location.href;\n        var loc = str.substring(str.indexOf('documents') + 10);\n        navigator.clipboard.writeText(loc);\n    }}>Copy to Clipboard</button>\n  </div>\n\n  <div id=\"status\">\n    <Offline id = \"offline\">\n        You are Offline, Please Check your Connection and Try Again!\n    </Offline>\n\n\n\n  </div>\n  <div className=\"text container\" ref={wrapperRef}></div>\n\n  </>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}